## 8.7 Programmable Completion Builtins
프로그래밍 가능한 완성 기능을 조작에는 3개의 빌트인 명령어를 사용할 수 있습니다. 하나는 특정 명령어의 인수를 어떻게 완성시킬지 지정하며, 둘은 완성이 일어났을 때 이를 편집할 때 사용합니다.

**compgen**

```sh
compgen [option] [word]
```
*option*에 따라서 *word*와 일치하는 완성 후보를 생성합니다. 옵션으로 `-p`와 `-r`을 제외한 `complete` 빌트인이 처리할 수 있는 옵션을 사용할 수 있으며, 일치 결과를 표준 출력으로 출력합니다. `-F`나 `-C` 옵션을 사용할 때 프로그래밍 가능한 완성 기능에 의해서 다양한 셸 변수가 설정됩니다만. 설정될 때까지는 유용한 값을 가지고 있지 않습니다.

일치 결과는 프로그래밍 가능한 완성 코드가 완성 명세로부터 같은 플래그를 가지고 생성한 것과 동일한 방식으로 생성됩니다. *word*를 지정했다면 *word*와 일치하는 완성만을 출력할 것입니다.

잘못된 옵션을 넘기거나 일치한 결과가 없는 경우가 아니라면 반환 값은 참입니다.

**complete**

```sh
complete [-abcdefgjksuv] [-o comp-option] [-DEI] [-A action] [-G globpat]
[-W wordlist] [-F function] [-C command] [-X filterpat]
[-P prefix] [-S suffix] name [name …]
complete -pr [-DEI] [name …]
```

각 *name*의 인수를 어떻게 완성할지 지정합니다. `-p` 옵션을 넘기거나 아무 옵션도 넘기지 않는다면, 존재하는 완성 명세를 입력으로 재활용 가능한 형식으로 출력합니다. `-r` 옵션은 각 *name*의 완성 명세를 제거하거나 *name*을 넘기지 않았다면 모든 완성 명세를 제거합니다. `-D` 옵션은 넘긴 다른 옵션과 액션을 "기본" 명령어 완성에 적용하라고 지시합니다. 다르게 말하면, 이전에 완성을 정의하지 않은 명령어에 대해서 완성을 시도합니다. `-E` 옵션은 넘긴 다른 옵션과 액션이 "빈" 명령어 완성에 적용하라고 지시합니다. 이는 빈 라인에서 완성을 시도할 때 사용됩니다. `-I` 옵션은 넘긴 다른 옵션과 액션이 줄에서 대입이 아닌 첫번째 단어, 또는 ','나 '|'와 같은 명령어 구분자 뒤의 완성에 적용하라고 지시합니다. 이는 보통 명령어 이름 완성입니다. 옵션을 여러 개 넘긴 경우, `-D` 옵션이 `-E` 보다 우선되며, 이 둘은 `-I`보다 우선됩니다. `-D`, `-E`, `-I` 중 하나가 지정되었다면 다른 *name* 인수는 무시됩니다. 일반적으로 이 완성은 명령어 이름 완성입니다.

단어 완성을 시도할 때 완성 명세를 적용하는 처리에 대해서는 위에서 설명했습니다([Programmable Completion](chapter_8_6.html)을 참조).

그 이외의 옵션들을 넘겼다면 다음과 같은 의미를 가집니다. `-G`, `-W`, `-X` (필요하다면 `-P`와 `-S`) 옵션의 인수는 `complete` 빌트인을 호출하기 전에 전개되지 않도록 따옴표로 감싸야 합니다.

- **-o *comp-option***

  *comp-option*은 단순히 완성을 생성하는 것만 아니라 완성 명세 동작의 여러 부분을 제어합니다. *comp-option*은 다음 중 하나입니다.
  - bashdefault
    완성 명세가 일치하는 결과를 생성하지 못한다면, 기본 Bash 완성의 나머지를 실행합니다.
  - default
    완성 명세가 일치하는 결과를 생성하지 못한다면, Readline의 기본 파일명 완성을 사용합니다.
  - dirnames
    완성 명세가 일치하는 결과를 생성하지 못한다면, 디렉터리명 완성을 실행합니다.
  - filenames
    Readline에게 완성 명세가 파일명을 생성한다고 알려주고, 파일명 고유의 처리(디렉터리명 뒤에 슬래시를 추가하거나, 특수 문자를 따옴표로 감싸거나, 끝에 따라오는 스페이스를 제거하는 등의 처리)를 할 수 있도록 합니다. 이 옵션은 `-F`로 지정한 셸 함수와 사용하는 것을 상정하고 있습니다.
  - noquote
    Readline에게 완성된 단어가 파일명(파일명을 따옴표로 감싸는 것이 기본 동작입니다)이라면 따옴표로 감싸지 말라고 알려줍니다.
  - nosort
    Readline에게 완성 후보 리스트를 알파벳 순으로 정렬하지 말라고 알려줍니다.
  - nospace
    Readline에게 줄의 끝에서 완성된 단어 뒤에 스페이스를 추가하지 말라고 알려줍니다(스페이스를 추가하는 것은 기본 동작입니다).
  - plusdirs
    완성 명세로 정의된 일치가 생성된 후에 디렉터리명 완성을 시도하고 이를 다른 액션의 결과에 추가합니다.
- **-A *action***

  *action*은 다음 중 하나로, 완성 후보 리스트를 생성합니다.
  - alias
    별칭 이름. `-a`로도 지정할 수 있습니다.
  - arrayvar
    배열 변수 이름.
  - binding
    Readline 키 바인딩 이름([Bindable Readline Commands](chapter_8_4.html)를 참조).
  - builtin
    셸 빌트인 명령어의 이름. `-b`로도 지정할 수 있습니다.
  - command
    명령어 이름. `-c`로도 지정할 수 있습니다.
  - directory
    디렉터리 이름. `-d`로도 지정할 수 있습니다.
  - disabled
    비활성화된 셸 빌트인 이름.
  - enabled
    활성화된 셸 빌트인 이름.
  - export
    익스포트한 셸 변수 이름. `-e`로도 지정할 수 있습니다.
  - file
    파일 이름. `-f`로도 지정할 수 있습니다.
  - function
    셸 함수 이름.
  - group
    그룹 이름. `-g`로도 지정할 수 있습니다.
  - helptopic
    `help` 빌트인(Bash Builtins를 참조)이 받을 수 있는 도움말 주제.
  - hostname
    `HOSTFILE` 셸 변수([Bash Variables](chapter_5_2.html)를 참조)로 지정한 파일에서 가져온 호스트명.
  - job
    잡 컨트롤이 활성화되어 있다면, 잡 이름. `-j`로도 지정할 수 있습니다.
  - keyword
    셸 예약어. `-k`로도 지정할 수 있습니다.
  - running
    잡 컨트롤이 활성화되어 있다면, 실행중인 잡 이름.
  - service
    서비스 이름. `-s`로도 지정할 수 있습니다.
  - setopt
    `set` 빌트인의 `-o` 옵션에 넘길 수 있는 유효한 인수([The Set Builtin](chapter_4_3_1.html)을 참조).
  - shopt
    `shopt` 빌트인이 받을 수 있는 셸 옵션([The Set Builtin](chapter_4_3_1.html)을 참조).
  - signal
    시그널 이름.
  - stopped
    잡 컨트롤이 활성화되어 있다면, 중단된 잡 이름.
  - user
    유저명. `-u`로도 지정할 수 있습니다.
  - variable
    모든 셸 변수 이름. `-v`로도 지정할 수 있습니다.
- **-C *command***

  *command*는 서브셸 환경에서 실행되며, 그 출력이 완성 후보로 사용됩니다.
- **-F *function***

  셸 함수 *function*은 현재 셸 환경에서 실행됩니다. 위에서 설명했듯이([Programmable Completion](chapter_8_6.html)을 참조), 실행될 때 `$1`은 완성 대상인 인수의 명령어 이름이며, `$2`는 완성 대상인 단어, `$3`은 완성 대상인 단어 앞의 단어입니다. 종료할 때, `COMPREPLY` 배열 변수의 값으로부터 완성 후보를 가져옵니다.
- **-G *globpat***

  완성 후보를 생성하기 위해 파일명 전개 패턴 *globpat*을 전개합니다.
- **-P *prefix***

  다른 옵션이 모두 적용된 뒤에 각각의 완성 후보의 첫머리에 *prefix*를 추가합니다.
- **-S *suffix***

  다른 옵션이 모두 적용된 뒤에 각각의 완성 후보의 끝머리에 *suffix*를 추가합니다.
- **-W *wordlist***

  *wordlist*는 `IFS` 특수 변수를 구분자로 사용하여 분할되며 각 단어를 전개합니다. 완성 후보는 전개 결과에서 완성 대상 단어와 일치하는 구성원이 됩니다.
- **-X *filterpat***

  *filterpat*은 파일명 전개에서 사용되는 패턴입니다. 선행하는 옵션과 인수로부터 생성된 완성 후보 리스트에 적용되며, *filterpat*과 일치하는 후보를 리스트에서 제거합니다. *filterpat*의 첫머리가 '!'로 시작하면 부정 패턴이 됩니다. 이 경우 *filterpat*과 일치하지 않는 후보를 제거합니다.

잘못된 옵션을 넘기거나 `-p`나 `-r` 이외의 옵션을 *name* 인수 없이 넘기거나 명세가 존재하지 않는 *name*의 완성 명세를 제거하려는 시도나 완성 명세를 추가할 때 에러가 발생한 경우가 아니라면 반환값은 참입니다.

**compopt**

```sh
compopt [-o option] [-DEI] [+o option] [name]
```

각 *name*의 완성 옵션을 *option* 값에 따라서 변경합니다. *name*을 넘기지 않았다면 현재 실행중인 완성을 변경합니다. *option*이 주어지지 않았다면, 각 *name*의 완성 또는 현재 완성의 완성 옵션을 보여줍니다. *option*으로 사용할 수 있는 값은 `complete` 빌트인에서 설명한 옵션과 같습니다. `-D` 옵션은 넘긴 다른 옵션과 액션을 "기본" 명령어 완성에 적용하라고 지시합니다. 다르게 말하면, 이전에 완성을 정의하지 않은 명령어에 대해서 완성을 시도합니다. `-E` 옵션은 넘긴 다른 옵션과 액션이 "빈" 명령어 완성에 적용하라고 지시합니다. 이는 빈 라인에서 완성을 시도할 때 사용됩니다. `-I` 옵션은 넘긴 다른 옵션과 액션이 줄에서 대입이 아닌 첫번째 단어, 또는 ','나 '|'와 같은 명령어 구분자 뒤의 완성에 적용하라고 지시합니다. 일반적으로 이 완성은 명령어 이름 완성입니다.

옵션을 여러 개 넘긴 경우, `-D` 옵션이 `-E` 보다 우선되며, 이 둘은 `-I`보다 우선됩니다.

잘못된 옵션을 넘기거나 완성 명세가 존재하지 않는 *name*의 옵션을 변경하려는 시도나 출력 에러가 발생한 경우가 아니라면 반환값은 참입니다.
