### 3.2.3 Pipelines

파이프라인이란 제어 연산자의 하나인 '|', '|&'를 사용하여 나눠지는 하나 이상의 명령어 나열을 의미합니다.

파이프라인의 형식은 다음과 같습니다.

```sh
[time [-p]] [!] command1 [ | or |& ] command2 ] ...
```

파이프라인의 각 명령어의 출력은 파이프를 통해 다음 명령어의 입력으로 연결됩니다. 그러니까 각 명령어는 직전 명령의 출력을 읽습니다. 명령어에 의해서 어떤 리다이렉션이 지정되기 전에만 이루어집니다.

만약 '|&'를 사용한다면, command1의 표준 에러가 표준 출력과 함께 파이프를 통해 command2의 표준 출력으로 연결됩니다. 이는 `2>&1 |` 의 짧은 표현입니다. 이 표준 에러를 표준 출력으로 연결하는 암묵적인 리다이렉션은 명령어에 의해 지정된 어떤 리다이렉션의 뒤에서라도 동작합니다.

예약어 `time` 을 사용하면 파이프라인 처리가 완료될 때에 실행 시간에 대한 통계정보를 출력합니다. 이 정보는 걸린 시간과 명령어 실행에 소모된 유저/시스템 시간으로 이루어져있습니다. '-p' 옵션은 출력 형식을 POSIX 준거로 바꿔줍니다. 만약 셸이 POSIX 모드에서 실행되고 있다면, 다음 토큰이 '-'로 시작하지 않는 경우 `time`를 예약어로 처리되지 않습니다. `TIMEFORMAT` 변수를 지정하여 어떤 형식으로 시간 정보를 출력할지 변경할 수도 있습니다. 사용가능한 형식에 대해서는 [Bash Variables](chapter_5_2.html)를 참조하세요. `time`을 예약어로 사용하면 셸의 빌트인 명령어, 셸 함수, 파이프라인의 실행 시간을 계측할 수 있습니다. 외부의 `time` 명령어는 이처럼 간단하게 시간을 잴 수 없습니다.

셸이 POSIX 모드에서 동작할 때, `time` 뒤에는 개행이 따라옵니다. 이 경우, 셸은 셸과 그 자식들에 의해 소비된 모든 유저/시스템 시간을 표시합니다. `TIMEFORMAT` 변수를 사용하여 출력 형식을 변경할 수 있습니다.

파이프라인이 비동기로 실행되지 않는다면, 셸은 파이프라인의 모든 명령어의 실행이 종료되는 것을 기다립니다.

파이프라인의 각 명령어는 각각의 서브셸에서 실행됩니다. 이 서브셸은 별도의 프로세스입니다([Command Execution Environment](chapter_3_7_3.html)를 참조). `shopt` 빌트인에서 `lastpipe` 옵션을 켰다면 파이프라인의 마지막 원소는 셸 프로세스에서 실행됩니다.

파이프라인의 종료 스테이터스는 `pipefail` 옵션을 켠 상태가 아니라면 파이프라인의 마지막 명령어의 종료 스테이터스입니다. 만약 `pipefail` 옵션을 켠 상태라면 파이프라인의 반환 스테이터스는 0이 아닌 스테이터스로 종료된 오른쪽 끝의 명령어의 반환 스테이터스를 돌려주거나, 모든 명령어들이 성공적으로 종료되었다면 0을 반환합니다. 파이프라인의 시작 부분에서 예약어 '!'가 있다면, 종료 스테이터스는 위에서 설명한 종료 스테이터스의 논리 부정값(원문은 logical nagation)입니다. 셸은 값을 반환하기 전에 파이프라인의 모든 명령어의 실행이 종료될 때까지 기다립니다.
