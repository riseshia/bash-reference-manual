### 3.5.3 Shell Parameter Expansion

'`$`'는 매개변수 전개, 명령어 치환, 산술 전개를 실행하는 문자입니다. 전개할 매개변수 이름과 기호는 중괄호로 감쌀 수 있습니다. 이는 선택사항입니다만, 뒤따라오는 문자와 결합해 이름으로 인식되어 전개되지 않도록 보호하는 역할을 합니다.

중괄호의 끝은 백슬래시로 이스케이프하지 않거나 따옴표로 감싸지 않은 첫번째 '`}`'이며, 이는 산술 전개, 명령어 치환, 매개변수 전개 도중이면 안됩니다.

매개변수 전개의 기본 형식은 *${parameter}*입니다. *parameter*의 값이 치환됩니다. *parameter*는 이전에 설명한 셸 매개변수([Shell Parameters](chapter_3_4.html)를 참조) 또는 배열 참조([Arrays](chapter_6_7.html)를 참조)입니다. *parameter*가 하나 이상의 숫자를 가지고 있는 위치 매개변수이거나 *parameter* 뒤에 이름의 일부로 해석하고 싶지 않은 문자가 오는 경우 중괄호를 사용해야 합니다.

*parameter*의 첫 문자가 느낌표(!)이고, *parameter*가 *nameref*가 아니라면, 간접 전개가 적용됩니다. Bash는 *parameter*의 나머지를 전개하여 생성한 값을 새 *parameter*로 사용합니다. 다시 말하면, 본래의 *parameter* 대신 전개된 값을 이후의 전개에서 사용합니다. 이를 간접 전개라고 부르며, 이 값은 물결줄표 전개, 매개변수 전개, 명령어 치환 및 산술 전개의 영향을 받습니다. *parameter*가 nameref라면  완전한 간접 전개를 수행하는 대신 *parameter*가 참조하는 변수의 이름으로 전개됩니다. 이에 대한 예외는 아래에서 설명할 ${!*prefix*\*}와 ${!*name*\[@]}의 전개입니다. 간접 전개를 사용하고 싶다면, 느낌표를 왼쪽 중괄호 바로 뒤에 두어야 합니다.

다음 각 예제에서 *word*는 물결줄표 전개, 매개변수 전개, 명령어 치환, 산술 전개가 적용됩니다.

부분 문자열 전개중이 아니라면, 아래에서 설명된 형식(예: '`:-`')을 사용하여 Bash는 매개변수가 설정되어있지 않거나 널인지 테스트합니다. 콜론을 생략하면 매개변수에 값이 설정되어있는지만 테스트합니다. 즉 콜론이 포함된 경우, 연산자는 *parameter*가 존재하는지, 그리고 그 값이 널이 아닌지 확인합니다. 만약 콜론이 생략되었다면 연산자는 존재 여부만 확인합니다.

- **${*parameter*:-*word*}**

  *parameter*가 존재하지 않거나 비어있다면 *word*의 전개값으로 치환합니다. 그렇지 않다면 *parameter*로 치환합니다.
- **${*parameter*:=*word*}**

  *parameter*가 존재하지 않거나 비어있다면 *word*이 *parameter*에 대입됩니다. 그 후에 *parameter*의 값으로 치환합니다. 위치 매개변수와 특수 매개변수는 이 방식으로 대입할 수 없습니다.
- **${*parameter*:?*word*}**

  *parameter*가 존재하지 않거나 비어있다면 *word*의 전개 결과(또는 *word*가 존재하지 않는다면 그에 관한 메시지)를 표준 에러 출력과 셸에 출력하며, 인터랙티브 모드가 아니라면 종료합니다. 그렇지 않다면 *parameter*의 값으로 치환합니다.
- **${*parameter*:+*word*}**

  *parameter*가 존재하지 않거나 비어있다면 치환하지 않습니다. 그렇지 않다면, *word*로 치환합니다.
- **${*parameter*:*offset*}**

- **${*parameter*:*offset*:*length*}**

  부분 문자열 전개라고 부릅니다. 이는 *parameter*의 값으로부터 *offset*으로 지정된 문자로부터 시작해 *length*개의 문자로 전개합니다. 만약 *parameter*가 '`@`', '`@`'나 '`*`'로 수식중인 순차 배열, 연상 배열의 이름이라면 결과가 다르며 아래에서 확인할 수 있습니다. 만약 *length*를 생략하면 *offset*으로 지정한 문자로부터 *parameter*의 마지막 문자까지 전개합니다. *length*와 *offset*은 산술 표현식입니다([Shell Arithmetic](chapter_6_5.html)을 참조).
  만약 *offset*이 0보다 작은 숫자로 평가된다면, *parameter*의 값의 끝부분으로부터의 오프셋으로 사용됩니다. *length*가 0보다 작은 숫자로 평가된다면, 전개할 문자의 개수 제한이 아닌 *parameter*의 의 값의 마지막으로부터의 오프셋으로 인식되어 *offset*과 이 값의 사이에 있는 문자들로 전개됩니다. 음수 오프셋은 '`:-`' 전개와 의미가 겹치므로 이를 피하기 위해서 콜론과 적어도 하나의 스페이스의 간격을 두어야 합니다.
  다음은 매개변수와 배열의 첨자를 사용한 부분 문자열 전개 예시입니다.
  ```
  $ string=01234567890abcdefgh
  $ echo ${string:7}
  7890abcdefgh
  $ echo ${string:7:0}
  ```
  ```sh
  $ echo ${string:7:2}
  78
  $ echo ${string:7:-2}
  7890abcdef
  $ echo ${string: -7}
  bcdefgh
  $ echo ${string: -7:0}
  ```
  ```sh
  $ echo ${string: -7:2}
  bc
  $ echo ${string: -7:-2}
  bcdef
  $ set -- 01234567890abcdefgh
  $ echo ${1:7}
  7890abcdefgh
  $ echo ${1:7:0}
  ```
  ```sh
  $ echo ${1:7:2}
  78
  $ echo ${1:7:-2}
  7890abcdef
  $ echo ${1: -7}
  bcdefgh
  $ echo ${1: -7:0}
  ```
  ```sh
  $ echo ${1: -7:2}
  bc
  $ echo ${1: -7:-2}
  bcdef
  $ array[0]=01234567890abcdefgh
  $ echo ${array[0]:7}
  7890abcdefgh
  $ echo ${array[0]:7:0}
  ```
  ```sh
  $ echo ${array[0]:7:2}
  78
  $ echo ${array[0]:7:-2}
  7890abcdef
  $ echo ${array[0]: -7}
  bcdefgh
  $ echo ${array[0]: -7:0}
  ```
  ```sh
  $ echo ${array[0]: -7:2}
  bc
  $ echo ${array[0]: -7:-2}
  bcdef
  ```
  만약 매개변수가 '`@`'라면, 결과는 *offset*으로부터 시작하는 *length* 길이의 위치 매개변수입니다. 음수의 *offset*은 가장 마지막의 위치 매개변수의 뒷자리로부터 상대적인 위치를 계산하므로, -1은 가장 마지막 위치 매개변수로 평가됩니다. *length*가 0보다 작은 값일 경우 전개 에러가 발생합니다.
  다음은 위치 매개변수를 사용한 부분 문자열 전개 예시입니다.
  ```sh
  $ set -- 1 2 3 4 5 6 7 8 9 0 a b c d e f g h
  $ echo ${@:7}
  7 8 9 0 a b c d e f g h
  $ echo ${@:7:0}
  ```
  ```sh
  $ echo ${@:7:2}
  7 8
  $ echo ${@:7:-2}
  bash: -2: substring expression < 0
  $ echo ${@: -7:2}
  b c
  $ echo ${@:0}
  ./bash 1 2 3 4 5 6 7 8 9 0 a b c d e f g h
  $ echo ${@:0:2}
  ./bash 1
  $ echo ${@: -7:0}
  ```
  만약 *parameter*가 '`@`'나 '`*`' 첨자를 사용하는 순차 배열라면, 결과는 \${*parameter*\[offset]} 요소로부터 *length*개의 요소가 됩니다. 음수 *offset*은 지정된 배열의 인덱스 최대값보다 하나 큰 값으로부터 상대값을 취합니다. *length*가 0보다 작은 경우 전개 에러가 발생합니다.
  다음은 순차 배열을 사용한 부분 문자열 전개 예시입니다.
  ```sh
  $ array=(0 1 2 3 4 5 6 7 8 9 0 a b c d e f g h)
  $ echo ${array[@]:7}
  7 8 9 0 a b c d e f g h
  $ echo ${array[@]:7:2}
  7 8
  $ echo ${array[@]: -7:2}
  b c
  $ echo ${array[@]: -7:-2}
  bash: -2: substring expression < 0
  $ echo ${array[@]:0}
  0 1 2 3 4 5 6 7 8 9 0 a b c d e f g h
  $ echo ${array[@]:0:2}
  0 1
  $ echo ${array[@]: -7:0}
  ```
  부분 문자열 전개를 연상 배열에 적용하는 것은 미정의 동작입니다.
  부분 문자열 색인은 위치 매개변수가 사용되지 않았다면 0부터 시작합니다만, 사용했다면 1부터 시작합니다. *offset*으로 0을 지정하고, 위치 매개변수를 사용했다면 `$0`이 리스트의 선두에 옵니다.
- **${!*prefix*\*}**

- **${!*prefix*@}**

  *prefix*로 시작하는 변수의 이름들로 전개합니다. 각 값은 `IFS` 특수 변수의 첫번째 문자로 구분됩니다. 만약 '`@`'이 사용되고 전개가 큰따옴표 내부에 있다면 각 변수 이름은 별개의 단어로 전개됩니다.
- **${!*name*\[@]}**

- **${!*name*\[\*]}**

  *name*이 배열 변수일 경우, *name*에 대입된 배열의 키 리스트로 전개됩니다. 만약 *name*이 배열 변수가 아니고, 변수가 존재한다면 0으로, 그렇지 않다면 널로 전개됩니다. '`@`'이 사용되고, 전개가 큰 따옴표 내부에 있다면, 각 키는 별개의 단어로 전개됩니다.
- **${#*parameter*}**

  *parameter*를 전개한 값의 문자 개수로 치환됩니다. 만약 *parameter*가 '`*`'나 '`@`'라면, 위치 매개변수의 갯수로 치환됩니다. 만약 *parameter*가 '`*`'와 '`@`'를 사용하는 배열의 첨자표기라면 배열이 가진 요소의 개수로 치환됩니다. 만약 *parameter*가 음수를 첨자로 가지는 이름이라면, 숫자는 *parameter*의 인덱스 최대값보다 하나 큰 숫자로부터의 상대값으로 취급되므로, -1은 마지막 요소를 참조합니다.
- **${*parameter*#*word*}**

- **${*parameter*##*word*}**

  *word*는 나중에 설명하는 규칙([Pattern Matching](chapter_3_5_8.html#3581-pattern-matching)을 참조)에 따르는 패턴을 생성하고 일치 검사를 하기 위해서 전개됩니다. *parameter*의의 전개된 값의 첫머리에 패턴이 일치하면, 전개의 결과는 *parameter*와 일치한 가장 짧은 패턴('`#`'의 경우)이나 가장 긴 패턴('`##`'의 경우)이 제거된 값입니다. 만약 *parameter*가 '`*`'나 '`@`'라면 각 위치 매개변수에 대해서 삭제가 실행되며 전개의 결과는 삭제가 완료된 각 요소의 리스트입니다. 만약 *parameter*가 '`*`'와 '`@`'를 사용하는 배열의 첨자표기라면 패턴 삭제 동작은 배열의 각 요소에 대해서 수행되며, 전개의 결과는 삭제가 완료된 각 요소의 리스트입니다.
- **${*parameter*%*word*}**

- **${*parameter*%%*word*}**

  *word*는 나중에 설명하는 규칙([Pattern Matching](chapter_3_5_8.html#3581-pattern-matching)을 참조)에 따르는 패턴을 생성하고 일치 검사를 하기 위해서 전개됩니다. *parameter*의의 전개된 값의 끄트머리에 패턴이 일치하면, 전개의 결과는 *parameter*와 일치한 가장 짧은 패턴('`%`'의 경우)이나 가장 긴 패턴('`%%`'의 경우)이 제거된 값입니다. 만약 *parameter*가 '`*`'나 '`@`'라면 각 위치 매개변수에 대해서 삭제가 실행되며 전개의 결과는 삭제가 완료된 각 요소의 리스트입니다. 만약 *parameter*가 '`*`'와 '`@`'를 사용하는 배열의 첨자표기라면 패턴 삭제 동작은 배열의 각 요소에 대해서 수행되며, 전개의 결과는 삭제가 완료된 각 요소의 리스트입니다.
- **${*parameter*/*pattern*/*string*}**

  *pattern*은 파일명 전개와 동일한 패턴을 생성합니다. *parameter*를 전개하고, *pattern*과 일치하는 가장 긴 일치 결과를 `string`으로 치환합니다. 일치는 나중에 설명하는 규칙([Pattern Matching](chapter_3_5_8.html#3581-pattern-matching)을 참조)에 따라서 수행됩니다. 만약 *pattern*을 '`/`'로 시작하면, 모든 *pattern*의 일치 결과를 *string*으로 치환합니다. 일반적으로 첫번째 일치만을 치환합니다. *pattern*을 '`#`'으로 시작하면 *parameter*를 전개한 값의 첫머리와 일치해야 합니다. *pattern*을 '`%`'로 시작하면 *parameter*를 전개한 값의 끝머리와 일치해야 합니다. 만약 *string*이 비어있다면 *pattern*과 일치한 결과는 제거되며 *pattern* 뒤의 `/`를 생략할 수 있습니다. 만약 셸 옵션 `nocasematch`([The Shopt Builtin](chapter_4_3_2.html)을 참조)가 켜져있다면 일치하는지 검사할 때 대소문자를 구별하지 않습니다. 만약 *parameter*가 '`@`'나 '`*`'라면 치환 동작은 각 위치 매개변수에 대해서 수행되며, 전개의 결과는 치환이 완료된 각 요소의 리스트입니다.
- **${*parameter*^*pattern*}**

- **${*parameter*^^*pattern*}**

- **${*parameter*,*pattern*}**

- **${*parameter*,,*pattern*}**

  이 전개는 *parameter*의 대소문자를 변경합니다. *pattern*이 파일명 전개와 동일한 패턴을 생성합니다. *parameter*를 전개한 결과의 각 문자에 대해서 *pattern*으로 검사하며, 만약 일치한다면 대문자는 소문자로, 소문자는 대문자로 변경합니다. 패턴은 한 글자만을 검사해야합니다. '`^`' 연산자는 *pattern*에 일치하는 소문자를 대문자로 변경합니다. '`,`' 연산자는 일치하는 대문자를 소문자로 변경합니다. '`^^`'와 '`,,`'는 전개된 값에서 일치한 모든 문자에 대해서 변경을 수행합니다. '`^`'와 '`,`'는 전개된 값에서 일치한 첫번째 문자만을 변경합니다. *pattern*이 생략된다면, 모든 문자와 일치하는 '`?`'가 주어진 것처럼 동작합니다. *parameter*가 '`@`'나 '`*`'라면 대소문자 변경 동작은 각 위치 매개변수에 대해서 수행되며, 전개의 결과는 치환이 완료된 각 요소의 리스트입니다. 만약 *parameter*가 '`@`'와 '`*`'를 사용하는 배열의 첨자표기라면 패턴 삭제 동작은 배열의 각 요소에 대해서 수행되며, 전개의 결과는 삭제가 완료된 각 요소의 리스트입니다.
- **${*parameter*@*operator*}**

  *operator*의 값에 따라서 *parameter*를 변환하거나, *parameter* 자신의 정보로 전개됩니다. *operator*는 단일 문자입니다.
  - **U**

    *parameter*의 알파벳 소문자를 대문자로 변환합니다.
  - **u**

    *parameter*의 첫 글자가 알파벳이라면, 이를 대문자로 변환합니다.
  - **L**

    *parameter*의 알파벳 대문자를 소문자로 변환합니다.
  - **Q**

    입력으로 재활용할 수 있도록 *parameter*를 따옴표로 감쌉니다.
  - **E**

    $'...' 구조처럼 *parameter*를 백슬래시로 이스케이프합니다.
  - **P**

    *parameter*가 프롬프트 문자열([Controlling the Prompt](chapter_6_9.html)를 참조)인 것처럼 전개합니다.
  - **A**

    *parameter*를 대입식이나 `declare` 명령의 형태로 변환합니다. 이를 평가하면 *parameter*를 같은 속성과 값을 가진 상태로 재생성할 수 있습니다. 
  - **K**

    *parameter*의 가능한 따옴표로 감싼 버전을 생성합니다. 단 순차/연상 배열의 값들은 따옴표로 감싼 키-값 쌍([Arrays](chapter_6_7.html)를 참조)의 나열로서 출력합니다.
  - **a**

    *parameter*의 속성값으로 구성된 문자열로 전개합니다.

  *parameter*가 '`@`'나 '`*`'라면 대소문자 변경 동작은 각 위치 매개변수에 대해서 수행되며, 전개의 결과는 치환이 완료된 각 요소의 리스트입니다. 만약 *parameter*가 '`@`'와 '`*`'를 사용하는 배열의 첨자표기라면 패턴 삭제 동작은 배열의 각 요소에 대해서 수행되며, 전개의 결과는 삭제가 완료된 각 요소의 리스트입니다.
  전개의 결과에는 나중에 설명할 단어 분리와 파일명 확장이 적용됩니다.