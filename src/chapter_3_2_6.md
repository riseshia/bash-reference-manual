### 3.2.6 Coprocesses

코프로세스는 `coproc` 예약어 뒤에 오는 셸 명령어를 가리킵니다. 코프로세스는 '&' 제어 연산자가 뒤에 붙어있는 명령어처럼 서브셸에서 비동기로 실행되며, 실행중인 셸과 양방향 파이프가 연결됩니다.

코프로세스의 포맷은 다음과 같습니다.

```sh
coproc [NAME] command [redirections]
```

이는 *NAME*이라는 이름을 가진 코프로세스를 생성합니다. 만약 *NAME*이 제공되지 않는다면 기본값인 *COPROC*이 사용됩니다. *NAME*은 *command*가 단순 명령어일 때에 사용해서는 안됩니다. 이 경우, 해당 명령의 첫번째 단어로 해석됩니다.

코프로세스가 실행된 이후, 셸은 실행중인 셸에 `NAME`이라는 배열 변수를 생성합니다. *command*의 표준 출력은 파이프를 통해 실행중인 셸의 파일 디스크립터에 연결되며, 이 파일 디스크립터는 `NAME[0]`에 대입됩니다. *command*의 표준 입력은 파이프를 통해 실행중인 셸의 파일 디스크립터에 연결되며, 이 파일 디스크립터는 `NAME[1]`에 대입됩니다. 이 파이프는 명령어의 리다이렉션 지정보다 먼저 생성됩니다. 파일 디스크립터들은 셸 명령어들의 인수나 표준 단어 전개의 리다이렉션 용도로 활용될 수 있습니다. 명령을 실행하거나 프로세스 치환을 위해 생성된 것 이외에는 파일 디스크립터는 서브셸에서 사용할 수 없습니다.

프로세스를 실행하기 위해 생성된 셸의 프로세스 ID는 `NAME`\_PID 변수의 값으로 저장되어 있습니다. `wait` 빌트인 명령어를 코프로세스의 종료를 기다리기 위해 사용할 수 있습니다.

코프로세스는 비동기 실행을 위해 생성되므로, `coproc` 명령의 실행은 언제나 성공합니다. 코프로세스의 반환 스테이터스는 *command*의 종료 스테이터스가 됩니다.
