## 6.11 Bash POSIX Mode
`--posix` 커맨드 라인 옵션과 함께 Bash를 시작하거나 Bash가 동작하는 중에 '`set -o posix`'를 실행하면 Bash는 표준과 다른 Bash의 기본 동작을 POSIX에 기술된대로 변경하여 POSIX 표준에 더 가까워지도록 합니다.

`sh`로 호출하면 Bash는 기동 파일을 읽은 뒤 POSIX 모드에 들어갑니다.

다음 목록은 'POSIX 모드'일 때 어떤 변경이 발생하는지 보여줍니다.

1. Bash는 `POSIXLY_CORRECT` 변수가 설정되어 있음을 보증합니다.
2. 해시 테이블의 명령어가 더 이상 존재하지 않을 때, Bash는 새 위치를 찾아 `$PATH`를 다시 검색합니다. 이 기능은 '`shopt -s checkhash`'로도 켤 수 있습니다.
3. Bash는 실행 가능 비트가 없는 명령어를 `$PATH` 검색의 결과로 반환되었다 하더라도 명령어 해시 테이블에 삽입하지 않습니다.
4. 0이 아닌 스테이터스로 종료했을 때 잡 컨트롤 코드와 빌트인이 출력하는 메시지는 'Done(status)'입니다.
5. 잡이 정지했을 때 잡 컨트롤 코드와 빌트인이 출력하는 메시지는 'Stopped(*signame*)'입니다. *signame*은 예를 들어, `SIGTSTP`를 말합니다.
6. 별칭 전개는 논-인터랙티브 셸이라해도 항상 켜져 있습니다.
7. 예약어가 인식되지 않는 컨텍스트에서의 예약어는 별칭 전개가 적용되지 않습니다.
8. POSIX의 `PS1`와 `PS2`의 '!'의 이력 번호에 대한 전개와 '!!'를 '!'로 전개하는 기능이 켜짐이 되며, `promptvars` 옵션의 값에 관계 없이 `PS1`과 `PS2`에서 매개변수 확장이 실행됩니다.
9. 일반 Bash 파일 대신 POSIX 기동 파일(`$ENV`)이 실행됩니다.
10. 물결줄표 전개는 줄의 모든 대입문에서 실행되지 않고 명령어 이름에 선행하는 대입에서만 실행됩니다.
11. 기본 이력 파일이 `~/.sh_history`가 됩니다(이는 `$HISTFILE`의 기본값입니다).
12. 셸이 인터랙티브 모드가 아니라면 리다이렉션 연산자는 리다이렉션에 포함된 파일명 전개를 실행하지 않습니다.
13. 리다이렉션 연산자는 리다이렉션에서 단어에서 단어 분리를 실행하지 않습니다.
14. 함수 이름은 반드시 유효한 셸 이름이어야 합니다. 다시 말해, 함수 이름은 영문자, 숫자, 밑줄만을 사용해야 하며, 숫자로 시작할 수 없습니다. 논-인터랙티브 셸에서 올바르지 않은 이름으로 함수를 선언하면 치명적인 에러가 발생합니다.
15. 함수 이름은 POSIX 특수 빌트인 명령어와 같은 이름을 사용할 수 없습니다.
16. POSIX 특수 빌트인은 명령어 탐색에서 셸 함수보다 먼저 검색됩니다.
17. 셸 함수 정의를 출력할 때(e.g., `type` 명령어), Bash는 `function` 키워드를 출력하지 않습니다.
18. `PATH`변수의 각 요소에서의 첫번째 글자로 나오는 물결줄표 문자는 [Tilde Expansion](chapter_3_5_2.html)에서 설명된 물결줄표 전개가 발생하지 않습니다.
19. `time` 예약어는 그 자체를 명령어로 사용할 수 있습니다. 이렇게 사용하면 셸과 셸의 완료된 자식들의 타이밍 통계를 보여줍니다. `TIMEFORMAT` 변수는 이 타이밍 정보의 형식을 제어합니다.
20. 큰따옴표 내부의 `${…}` 전개를 구문 분석하고 전개할 때, 패턴 제거를 실행하기 위해 정의된 연산자가 아니라면 작은따옴표를 특별하게 다루지 않으며, 닫는 중괄호나 다른 특수 문자를 감싸는 용도로 사용할 수 없습니다. 이 경우, 작은따옴표는 쌍으로 나타날 필요가 없습니다.
21. 파서는 `time`의 다음 토큰이 '-'로 시작할 때 `time`을 예약어로 인식하지 않습니다.
22. '!' 문자는 `histexpand` 옵션이 켜져있더라도 큰따옴표로 감싼 문자열 내부에서 이력 전개를 실행하지 않습니다.
23. POSIX 특수 빌트인이 에러 스테이터스를 반환하면, 논-인터랙티브 셸은 종료합니다. 치명적인 에러는 POSIX 표준에 나열되어 있습니다. 여기에는 잘못된 옵션 넘기기, 리다이렉션 에러, 명령어 앞에서의 변수 대입 에러 등이 포함됩니다.
24. 변수 대입문 이후에 명령어 이름이 따라오지 않을 때, 변수 대입 에러가 발생하면 논-인터랙티브 셸은 에러 스테이터스와 함께 종료합니다. 예를 들어, 읽기 전용 변수에 값을 대입하려고 시도하면 변수 대입 에러가 발생합니다.
25. 특수 빌트인의 앞에 오는 대입문에서 변수 대입 에러가 발생하면 논-인터랙티브 셸은 에러와 함께 종료합니다. 단순 명령어와 함께 동작할 때는 에러를 발생시키지 않습니다.
26. `for`문의 반복 변수나 `select`문의 선택 변수가 읽기 전용 변수라면 논-인터랙티브 셸은 에러와 함께 종료합니다.
27. '. *filename*'에서 *filename*을 찾을 수 없다면 논-인터랙티브 셸은 종료합니다.
28. 유효하지 않은 표현식의 산술 전개 결과에서 문법 에러가 발생하면 논-인터랙티브 셸은 종료합니다.
29. 매개변수 전개 에러가 발생하면 논-인터랙티브 셸은 종료합니다.
30. `.`나 `source` 빌트인으로 읽은 스크립트나 `eval` 빌트인을 처리한 문자열에 문법 에러가 있다면 논-인터랙티브 셸은 종료합니다.
31. 변수 간접 참조가 사용 가능하더라도 '#'과 '?' 특수 매개변수에는 적용할 수 없습니다.
32. 전개가 큰따옴표로 감싸진 패턴 컨텍스트에서 '*' 특수 매개변수를 전개할 때, `$*`를 큰따옴표로 감싸지 않은 것처럼 다룹니다.
33. POSIX 특수 빌트인의 앞에 오는 대입문의 영향은 빌트인이 실행 완료된 이후에도 셸 환경에 남습니다.
34. `command` 빌트인은 실행할 빌트인이 인수로 받은 대입문을 전개하는 것을 막지 못합니다. POSIX 모드가 아니라면, `command` 뒤에 오는 경우, 대입문 전개의 속성을 잃어버립니다.
35. `bg` 빌트인은 백그라운드에 위치한 각 잡을 기술하기 위해서 필요한 형식을 사용합니다만, 이 형식은 각 잡이 현재 잡인지 이전 잡인지에 대한 정보를 포함하지 않습니다.
36. '`kill -l`'은 한 줄에 모든 시그널 이름을 스페이스 구분에 '`SIG`' 접두사 없이 출력합니다.
37. `kill` 빌트인은 '`SIG`' 접두사를 사용하는 시그널 이름을 받지 않습니다.
38. `export`와 `readonly` 빌트인 명령어는 POSIX가 요구하는 형식으로 결과를 출력합니다.
39. `trap` 빌트인은 `SIG` 접두사 없이 시그널 이름을 출력합니다.
40. `trap` 빌트인은 첫번째 인수로 숫자로만 구성되고 유효한 시그널 번호가 아니라면, 첫번째 인수를 시그널에 트랩으로 설정할 수 있는지 확인하지 않으며, 시그널의 트랩이 존재했다면 시그널 처리를 원래 상태로 되돌립니다. 주어진 시그널을 원래 상태로 초기화하고 싶다면 첫번째 인수로 '-'를 사용해야 합니다.
41. `trap -p`는 트랩이 `SIG_DFL`으로 설정된 시그널만 출력하며, 이들은 셸이 시작할때 무시됩니다.
42. `.`와 `source` 빌트인은 파일명 인수를 사용하기 위해 현재 디렉터리가 `PATH`에 존재하지 않는 한 이를 탐색하지 않습니다.
43. POSIX 모드를 켜면 `inherit_errexit` 옵션이 켜는 것과 같은 효과가 있습니다. 그러므로 명령어 치환을 실행하기 위해 생성되는 서브셸은 부모 셸의 `-e` 옵션을 상속합니다. `inherit_errexit` 옵션이 켜져있지 않다면, Bash는 이러한 서브셸을 생성할 때 `-e` 옵션을 끕니다.
44. POSIX 모드를 켜면 `shift_verbose` 옵션을 켜는 것과 같은 효과가 있습니다. 그러므로 `shift`에 넘긴 숫자 인수가 위치 매개변수의 개수보다 크다면 에러를 발생시킵니다.
45. `alias` 빌트인이 별칭 정의를 보여줄 때, `-p` 옵션을 넘기지 않는 이상 각 별칭 앞에 '`alias `'를 출력하지 않습니다.
46. `set` 빌트인을 옵션 없이 호출하면 셸 함수 이름과 정의를 출력하지 않습니다.
47. `set` 빌트인을 옵션 없이 호출하면, 변수 값이 셸 메타 문자를 포함하지 않는다면, 출력 불가능한 문자를 포함하더라도 따옴표로 감싸지 않은 값을 출력합니다.
48. `cd` 빌트인을 *로지컬* 모드에서 호출했고 `$PWD`로부터 생성한 경로명과 인수로 넘겨진 디렉터리명이 존재하지 않는 디렉터리를 참조하는 경우, `cd`는 *피지컬* 모드로 넘어가는 대신 실패합니다.
49. `cd` 빌트인이 `$PWD`로부터 생성한 경로명의 길이와 인수로 넘긴 디렉터리 이름에 포함된 모든 심볼릭 링크를 전개한 길이가 *PATH_MAX*보다 커서 디렉터리를 변경하지 못할 때, `cd`는 주어진 디렉터리 이름을 사용하려고 시도하기보다는 실패합니다.
50. `pwd` 빌트인은 `-P` 옵션으로 파일 시스템을 검사하기를 요청하지 않아도 자신이 출력할 값이 현재 디렉터리와 같은지 검증합니다.
51. 이력을 나열할 때, `fc` 빌트인은 각 이력이 수정되었는지 아닌지에 대한 정보를 포함하지 않습니다.
52. `fc`의 기본 에디터는 `ed`입니다.
53. 실행할 수 없는 파일이 `$PATH`에서 발견한 유일한 이름이고, 이를 실행하려고 시도하지만, `type`와 `command` 빌트인은 이를 발견했다고 보고하지 않습니다.
54. `vi` 편집 모드는 `v` 명령어가 실행중이라면, `$VISUAL`과 `$EDITOR`를 확인하는 대신 `vi` 에디터를 직접 호출 합니다.
55. `xpg_echo` 옵션이 켜져있다면, Bash는 `echo`의 모든 인수를 옵션으로 인식하지 않습니다. 각 인수는 이스케이프 문자 변환이 이루어진 뒤 출력됩니다.
56. `ulimit` 빌트인은 `-c`와 `-f` 옵션의 블럭 사이즈 단위로 512바이트를 사용합니다.
57. `SIGCHLD`에 트랩이 설정되어 있을 때, `SIGCHLD`를 수신하더라도 `wait` 빌트인에 끼어들어서 즉시 반환하지 않습니다. 트랩 명령어는 각 자식이 종료한 후에 한번만 실행됩니다.
58. 트랩이 설정된 시그널은 `read` 빌트인에 끼어들 수 있습니다. Bash가 `read`를 실행하는 중에 트랩이 설정된 시그널을 수신하면, 트랩 핸들러가 실행되며 `read`는 128보다 큰 종료 스테이터스와 함께 반환됩니다.
59. Bash는 `wait` 빌트인이 종료된 백그라운드 프로세스의 스테이터스의 값을 얻어간 후 이러한 스테이터스의 리스트로부터 해당 값을 제거합니다.

POSIX 모드에서도 기본으로 구현하지 않는 POSIX 동작이 있습니다. 특히 다음 두 가지입니다.

1. `fc` 빌트인은 `FCEDIT`이 없다면, 기본값인 `ed`를 곧바로 사용하기 보다는 `$EDITOR`를 이력를 편집하기 위해 사용할 수 있는지 확인합니다. `fc`는 `EDITOR`가 없다면 `ed`를 사용합니다.
2. 위에서 언급했듯, Bash는 `echo` 빌트인의 완전한 호환성을 위해서 `xpg_echo` 옵션을 켜기를 요구합니다.

Bash는 빌드시에 `configure`에 `--enable-strict-posix-default`를 지정하여 기본 설정으로 POSIX 호환성을 가지도록 설정할 수 있습니다(Optional Features를 참조).
