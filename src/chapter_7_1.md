## 7.1 Job Control Basics
잡 컨트롤은 선택적으로 프로새스의 실행을 일시정지하거나 나중에 실행을 재개할 수 있도록 하는 기능을 가리킵니다. 유저는 일반적으로 운영체제의 터미널 드라이버와 Bash가 함께 제공하는 인터랙티브 인터페이스를 통해 이 기능을 사용합니다.

셸은 *잡*을 각 파이프라인과 연결합니다. 이를 통해 현재 실행중인 잡들의 목록을 유지하며, 이는 `jobs` 명령어로 출력할 수 있습니다. Bash는 잡을 비동기로 시작할 수 있으며 다음과 같은 줄을 출력합니다.

```sh
[1] 25647
```

이 출력은 이 잡의 잡 번호는 1번이고, 이 잡과 연결된 파이프라인의 마지막 프로세스의 프로세스 ID는 25647임을 의미합니다. 단일 파이프라인의 모든 프로세스는 동일한 잡의 구성원입니다. Bash는 잡 컨트롤의 기반으로 *잡* 추상화를 사용합니다.

잡 컨트롤을 다루는 유저 인터페이스를 다루기 쉽게 만들기 위해 운영체제는 현재 터미널 프로세스 그룹 ID라는 개념을 관리합니다. 이 프로세스 그룹의 구성원(현재 터미널 프로세스 그룹 ID와 동일한 프로세스 그룹 ID를 가지고 있는 프로세스)은 키보드로부터 생성된 `SIGINT`와 같은 시그널을 수신합니다. 이 프로세스들을 포어그라운드라고 부릅니다. 백그라운드 프로세스는 터미널의 프로세스 그룹 ID와 다른 프로세스 그룹 ID를 가지고 있습니다. 이러한 프로세스들은 키보드로부터 생성된 시그널을 무시합니다. 포어그라운드 프로세스만이 터미널을 읽거나 (`stty tostop`을 지정했다면) 터미널로 쓸 수 있습니다. 백그라운드 프로세스가 터미널을 읽으려고 (또는 `stty tostop`을 지정했을 때 쓰려고) 시도하면 커널의 터미널 드라이버로부터 `SIGTTIN`(`SIGTTOU`)시그널이 전송됩니다. 만약 이를 처리하지 않는다면 프로세스를 중단합니다.

Bash가 동작하고 있는 운영체제가 잡 컨트롤을 지원하면 Bash는 이를 사용하기 위한 기능을 유지합니다. 프로세스를 실행하는 중에 *suspend* 문자(일반적으로 '^z', Control-Z)를 입력하면 이 프로세스를 중단하고 Bash로 제어를 반환합니다. *delayed suspend* 문자(일반적으로 '^Y', Control-Y)를 입력하면 프로세스가 터미널로부터 입력을 받으려고 시도할 때 중단되며 Bash로 제어를 반환합니다. 그러면 사용자는 이 잡의 상태를 `bg` 명령어를 사용해서 백그라운드에서 실행을 재개하거나 `fg` 명령어로 포어그라운드에서 실행을 재개하거나 `kill` 명령어로 종료하는 조작을 할 수 있습니다. '^Z'는 즉시 실행되며 출력을 중단하고 입력중인 텍스트를 버리는 추가 부작용이 있습니다.

셸에서 잡을 참조하는 방법은 여러가지가 있습니다. '%' 문자는 잡 명세(*jobspec*)를 가리킵니다.

잡 번호 *n*은 '%n'으로 참조될 수 있습니다. '%%' 와 '%+' 기호는 셸의 현재 잡을 가리키며, 이는 포어그라운드에 있는 동안 정지했거나 백그라운드에서 시작된 마지막 잡입니다. (뒤따라오는 잡 명세가 없는) 단일 '%' 역시 현재 잡을 참조합니다. 이전 잡은 '%-'로 참조될 수 있습니다. 잡이 단 하나만 존재한다면, '%+'와 '%-'는 모두 해당 잡을 참조할 때 사용할 수 있습니다. 잡에 관한 출력(e.g., `jobs` 명령어의 출력)에서 현재 잡은 언제나 '+' 플래그를 가지며, 이전 잡은 '-'를 가집니다.

잡은 시작할 때 사용한 이름의 접두사 또는 그 커맨드 라인에서 나타나는 부문 문자열을 사용해서 참조할 수도 있습니다. 예를 들어 '%ce'는 명령어 이름이 'ce'로 시작하는 중단된 잡을 참조합니다. 한편 '%?ce'를 사용하면 잡의 커맨드 라인에 문자열 'ce'를 포함하는 어떤 잡을 참조합니다. 만약 접두사 또는 접미사가 2개 이상의 잡과 일치하면 Bash는 에러를 보고합니다.

단순히 잡에 이름을 지정해서 이를 포어그라운드로 가져올 수도 있습니다. '%1'는 'fg %1'와 동의어이며, 잡 1번을 백그라운드에서 포어그라운드로 가져옵니다. 비슷하게 '%1 &'는 잡 1번을 백그라운드에서 재개하며 이는 'bg %1'과 동일합니다.

셸은 잡의 상태가 변경되면 즉시 이를 이해합니다. 일반적으로 Bash는 다른 출력을 중단하지 않도록 잡의 상태 변경을 보고하기 전에 프롬프트의 출력 직전까지 기다립니다. `set` 빌트인으로 `-b` 옵션을 켰다면 Bash는 이러한 변경을 즉시 보고합니다([The Set Builtin](chapter_4_3_1.html)을 참조). `SIGCHLD`에 설정된 트랩은 각 자식 프로세스가 종료될 때 실행됩니다.

잡이 중단된 상태(또는 `checkjobs` 옵션이 켜져있다면 실행중일때. [The Shopt Builtin](chapter_4_3_2.html)을 참조)에서 Bash를 종료하려고 시도하면 셸은 경고 메시지를 출력하며 `checkjobs` 옵션이 켜져있다면 잡과 잡의 상태 리스트를 출력합니다. 잡의 상태를 확인하기 위해서 `jobs` 명령어를 사용할 수도 있습니다. 뒤이어서 바로 두번째 종료 시도를 하면, Bash는 다른 경고를 출력하지 않으며 중단된 잡을 모두 종료합니다.

셸이 잡이나 프로세스를 `wait` 빌트인을 사용하여 기다리고 있을 때, 잡 컨트롤이 켜져 있다면 `wait`는 잡의 상태가 변경될 때 반환됩니다. `-f` 옵션을 사용하면 `wait`가 반환되기 전에 잡이나 프로세스의 종료를 기다립니다.
