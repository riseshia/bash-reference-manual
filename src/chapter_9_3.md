## 9.3 History Interaction
이력 라이브러리는 `csh`가 제공하는 이력 전개와 유사한 이력 전개 기능을 제공합니다. 이 섹션에서는 이력 정보를 다루기 위한 문법에 대해서 설명합니다.

이력 전개는 명령어를 쉽게 반복해서 실행하거나 이전 명령어의 인수를 현재 입력 줄로 삽입하거나 이전 명령어의 에러를 간단하게 수정할 수 있도록 이력 리스트로부터 입력 스트림으로 단어를 가져오게 해줍니다.

이력 전개는 완전한 줄을 읽은 직후, 셸이 줄을 단어로 분리하기 전에 각 줄에 대해서 개별적으로 실행됩니다. Bash는 이전 줄로부터 따옴표로 감싼 상태가 아직 유효하다는 것을 이력 전개 기능에게 알려줍니다.

이력 전개는 두 부분으로 구성됩니다. 첫번째는 치환 중에 이력 리스트로부터 어떤 줄을 사용할 지 결정하는 것입니다. 두번째는 그 줄의 일부를 선택하여 현재 줄에 추가하는 것입니다. 이력에서 선택한 줄은 *이벤트*라고 부르며 그 줄에 있는 것들을 *단어*라고 부릅니다. 선택한 단어를 조작하는 다양한 *수식자*가 사용가능합니다. 줄은 Bash가 하는 것과 동일한 방식으로 단어로 분리되며, 그러므로 따옴표로 감싼 부분은 하나의 단어로 처리됩니다. 이력 전개는 이력 전개 문자가 출현하면 시작되며, 이 문자의 기본값은 '!'입니다.

이력 전개는 셸과 유사한 따옴표로 감싸기 규칙을 구현합니다. 백슬래시는 다음 문자의 특수성을 제거합니다. 작은따옴표로 감싼 문자열은 문자 그대로의 의미로 사용되며 이력 전개를 금지합니다. 그리고 큰따옴표로 감싼 문자열은 이력 전개 문자를 백슬래시로 이스케이프할 수 있으므로 이력 전개가 발생할 수 있습니다만, 작은따옴표는 큰따옴표 사이에서 특별한 취급을 받지 않기 때문에 이력 전개의 대상이 되지 못합니다.

셸에서는 '\\'와 '\''만 이력 전개 문자를 이스케이프할 수 있습니다만, 큰따옴표로 감싼 문자열의 닫는 큰따옴표 바로 앞에 오면 이력 전개 문자는 따옴표로 감싼 것처럼 동작합니다.

`shopt` 빌트인([The Shopt Builtin](chapter_4_3_2.html)을 참조)으로 설정가능한 몇몇 셸 옵션은 이력 전개의 행동을 제어할 수 있습니다. `histvarify` 셸 옵션이 켜져있고 Readline을 사용한다면 이력 치환은 셸 파서로 바로 넘겨지지 않습니다. 그 대신 추가 편집을 위해 전개된 줄을 Readline 편집 버퍼로 불러옵니다. Readline이 사용중이고 `histreedit` 셸 옵션이 켜져있다면, 실패한 이력 전개를 수정하기 위해 이를 Readline 편집 버퍼로 불러올 것입니다. `history` 빌트인 명령어에 `-p` 옵션을 넘기면 이력 전개 내용을 확인한 후에 사용할 수 있습니다. `history` 빌트인에 `-s` 옵션을 넘기면 명령어를 실제로 실행하지 않고 이력 리스트의 마지막에 추가해 이후에 사용할 수 있도록합니다. 이는 Readline과 함께 사용하면 무척 유용합니다.

셸은 이력 전개 기능에서 사용되는 여러 문자들을 이전에 설명했듯이([Bash Variables](chapter_5_2.html)를 참조) `histchars` 변수로 제어할 수 있습니다. 셸은 이력 파일에 기록할 때 이력의 타임 스탬프를 표시하기 위해서 이력 코멘트 문자를 사용합니다.

- [Event Designators](chapter_9_3_1.html) : 사용할 이력줄을 지정하는 방법.
- [Word Designators](chapter_9_3_2.html) : 관심있는 단어를 지정하기.
- [Modifiers](chapter_9_3_3.html) : 치환 결과를 수정하기.
